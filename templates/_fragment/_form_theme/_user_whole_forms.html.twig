{# Camp catalog search #}
{% block user_camp_search_widget %}
    {{ form_errors(form) }}

    <div class="row">
        <div class="col-12">
            {{ form_row(form.sortBy) }}
        </div>

        <div class="col-12">
            {{ form_row(form.phrase) }}
        </div>

        <div class="col-12">
            {{ form_row(form.age) }}
        </div>

        <div class="col-12">
            {{ form_row(form.from) }}
        </div>

        <div class="col-12">
            {{ form_row(form.to) }}
        </div>

        <div class="col-12">
            {{ form_row(form.isOpenOnly) }}
        </div>
    </div>

    <button type="submit" class="btn btn-primary btn-block mt-2">
        <i class="fas fa-search mr-2"></i> {{ 'form.user.camp_search.button'|trans }}
    </button>
{% endblock %}

{# Camper profile search #}
{% block user_camper_search_widget %}
    {{ form_errors(form) }}

    <div class="form-row">
        <div class="col-md-9">
            {{ form_row(form.phrase) }}
        </div>

        <div class="col-md-3">
            {{ form_row(form.sortBy) }}
        </div>
    </div>

    <button type="submit" class="btn btn-primary">{{ 'form.user.camper_search.button'|trans }}</button>
{% endblock %}

{# Application attachment file help text #}
{% block user_application_attachment_file_help %}
    {% set application_attachment_data = form.parent.vars.data %}
    {% set suppress_required_later_help = application_attachment_data.suppressRequiredLaterHelp %}
    {% set is_already_uploaded = application_attachment_data.isAlreadyUploaded %}
    {% set help_configured = application_attachment_data.help %}
    {% set is_help_configured = help_configured is not same as(null) and help_configured is not same as('') %}
    {% set is_required_later = application_attachment_data.isRequiredLater %}
    {% set extensions = application_attachment_data.extensions %}
    {% set extensions_text = extensions|join(', ') %}

    {% if help is not empty or is_already_uploaded or is_help_configured or is_required_later or extensions_text is not empty %}
        {% set help_attr = help_attr|merge({class: (help_attr.class|default('') ~ ' form-text text-muted')|trim}) %}

        <small id="{{ id }}_help" {% with { attr: help_attr } %} {{ block('attributes') }} {% endwith %}>
            {% if is_already_uploaded %}
                <strong class="text-success">
                    &check; {{ 'form.user.application_attachment.already_uploaded'|trans }}
                </strong>

                <br>
            {% endif %}

            {% if help is not empty %}
                {{ block('form_help_content') }}

                <br>
            {% endif %}

            {% if is_help_configured %}
                {{ help_configured }}

                <br>
            {% endif %}

            {% if is_required_later and not suppress_required_later_help %}
                {{ 'form.user.application_attachment.is_required_later'|trans }}

                <br>
            {% endif %}

            {% if extensions_text is not empty %}
                {{ 'form.user.application_attachment.allowed_formats'|trans }}:
                {{ extensions_text }}
            {% endif %}
        </small>
    {% endif %}
{% endblock %}

{# Application camper edit #}
{% block user_application_camper_widget %}
    {{ form_errors(form) }}

    {% set rendered_form %}
        {% if enable_camper_loading and loadable_campers is not empty and is_granted('IS_AUTHENTICATED_REMEMBERED') %}
            <div class="row mb-2">
                <div class="col-12">
                    <a href="javascript:void(0);" data-toggle="modal" data-target="#camper-load-modal-{{ name }}">
                        <i class="fas fa-user-circle"></i>

                        {{ 'form.user.camper.load_from_profile'|trans }}
                    </a>
                </div>
            </div>

            <div id="camper-load-modal-{{ name }}"
                 class="modal fade" tabindex="-1"
                 {{ stimulus_controller('mod--camper-load', {
                     nameFirstId: form.camperData.nameFirst.vars.id,
                     nameLastId: form.camperData.nameLast.vars.id,
                     nationalIdentifierId: form.camperData.nationalIdentifier.vars.id,
                     isNationalIdentifierAbsentId: form.camperData.isNationalIdentifierAbsent.vars.id,
                     bornAtId: form.camperData.bornAt.vars.id,
                     genderId: form.camperData.gender.vars.id,
                     dietaryRestrictionsId: form.camperData.dietaryRestrictions.vars.id,
                     healthRestrictionsId: form.camperData.healthRestrictions.vars.id,
                     medicationId: form.camperData.medication.vars.id,
                 }) }}
            >
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">{{ 'form.user.camper.modal.title'|trans }}</h5>

                            <button type="button"
                                    class="close"
                                    data-dismiss="modal"
                                    aria-label="{{ 'modal.button_close'|trans }}"
                            >
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>

                        <div class="modal-body">
                            <p>{{ 'form.user.camper.modal.text'|trans }}</p>

                            <div class="form-group">
                                <label for="camper-load-select-{{ name }}" class="required">
                                    {{ 'entity.camper.singular'|trans }}
                                </label>

                                <select class="form-control"
                                        id="camper-load-select-{{ name }}"
                                        {{ stimulus_target('mod--camper-load', 'select') }}
                                        {{ stimulus_action('mod--camper-load', 'updateSubmitButtonAvailability') }}
                                >
                                    <option value="" disabled="disabled" selected="selected">
                                        {{ 'form.common.choice.choose'|trans }}
                                    </option>

                                    {% for loadable_camper in loadable_campers %}
                                        <option data-camper-json="{{ loadable_camper|json_encode }}">
                                            {{ loadable_camper.nameFirst }}
                                            {{ loadable_camper.nameLast }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>

                        <div class="modal-footer">
                            <button type="button"
                                    class="btn btn-secondary"
                                    data-dismiss="modal"
                                    {{ stimulus_target('mod--camper-load', 'buttonClose') }}
                            >
                                {{ 'modal.button_close'|trans }}
                            </button>

                            <button type="button"
                                    class="btn btn-primary"
                                    {{ stimulus_target('mod--camper-load', 'buttonLoad') }}
                                    {{ stimulus_action('mod--camper-load', 'fillCamperForm') }}
                            >
                                {{ 'form.user.camper.modal.button'|trans }}
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}

        {{ form_rest(form) }}
    {% endset %}

    {% if 'collection_entry' in block_prefixes %}
        <div {{ block('widget_container_attributes') }}>
            {{ rendered_form }}
        </div>
    {% else %}
        {{ rendered_form }}
    {% endif %}
{% endblock %}

{# Camper edit #}
{% block user_camper_widget %}
    {{ form_errors(form) }}

    <div class="form-row">
        <div class="col-md-6">
            {{ form_row(form.nameFirst) }}
        </div>

        <div class="col-md-6">
            {{ form_row(form.nameLast) }}
        </div>
    </div>

    {{ form_rest(form) }}
{% endblock %}

{# Contact profile search #}
{% block user_contact_search_widget %}
    {{ form_errors(form) }}

    <div class="form-row">
        <div class="col-md-9">
            {{ form_row(form.phrase) }}
        </div>

        <div class="col-md-3">
            {{ form_row(form.sortBy) }}
        </div>
    </div>

    <button type="submit" class="btn btn-primary">{{ 'form.user.contact_search.button'|trans }}</button>
{% endblock %}

{# Contact edit #}
{% block user_contact_widget %}
    {{ form_errors(form) }}

    {% set rendered_form %}
        {% if enable_contact_loading and loadable_contacts is not empty and is_granted('IS_AUTHENTICATED_REMEMBERED') %}
            <div class="row mb-2">
                <div class="col-12">
                    <a href="javascript:void(0);" data-toggle="modal" data-target="#contact-load-modal-{{ name }}">
                        <i class="fas fa-user-circle"></i>

                        {{ 'form.user.contact.load_from_profile'|trans }}
                    </a>
                </div>
            </div>

            <div id="contact-load-modal-{{ name }}"
                 class="modal fade" tabindex="-1"
                 {{ stimulus_controller('mod--contact-load', {
                     nameFirstId: form.nameFirst.vars.id,
                     nameLastId: form.nameLast.vars.id,
                     emailId: form.email.vars.id,
                     phoneNumberId: form.phoneNumber.vars.id,
                     roleId: form.role.vars.id,
                     roleOtherId: form.roleOther.vars.id,
                 }) }}
            >
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">{{ 'form.user.contact.modal.title'|trans }}</h5>

                            <button type="button"
                                    class="close"
                                    data-dismiss="modal"
                                    aria-label="{{ 'modal.button_close'|trans }}"
                            >
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>

                        <div class="modal-body">
                            <p>{{ 'form.user.contact.modal.text'|trans }}</p>

                            <div class="form-group">
                                <label for="contact-load-select-{{ name }}" class="required">
                                    {{ 'entity.contact.singular'|trans }}
                                </label>

                                <select class="form-control"
                                        id="contact-load-select-{{ name }}"
                                        {{ stimulus_target('mod--contact-load', 'select') }}
                                        {{ stimulus_action('mod--contact-load', 'updateSubmitButtonAvailability') }}
                                >
                                    <option value="" disabled="disabled" selected="selected">
                                        {{ 'form.common.choice.choose'|trans }}
                                    </option>

                                    {% for loadable_contact in loadable_contacts %}
                                        <option data-contact-json="{{ loadable_contact|json_encode }}">
                                            {{ loadable_contact.nameFirst }}
                                            {{ loadable_contact.nameLast }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>

                        <div class="modal-footer">
                            <button type="button"
                                    class="btn btn-secondary"
                                    data-dismiss="modal"
                                    {{ stimulus_target('mod--contact-load', 'buttonClose') }}
                            >
                                {{ 'modal.button_close'|trans }}
                            </button>

                            <button type="button"
                                    class="btn btn-primary"
                                    {{ stimulus_target('mod--contact-load', 'buttonLoad') }}
                                    {{ stimulus_action('mod--contact-load', 'fillContactForm') }}
                            >
                                {{ 'form.user.contact.modal.button'|trans }}
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}

        <div class="form-row">
            <div class="col-md-6">
                {{ form_row(form.nameFirst) }}
            </div>

            <div class="col-md-6">
                {{ form_row(form.nameLast) }}
            </div>
        </div>

        {{ form_rest(form) }}
    {% endset %}

    {% if 'collection_entry' in block_prefixes %}
        <div {{ block('widget_container_attributes') }}>
            {{ rendered_form }}
        </div>
    {% else %}
        {{ rendered_form }}
    {% endif %}
{% endblock %}

{# Billing info edit #}
{% block user_billing_widget %}
    {{ form_errors(form) }}

    <div class="form-row">
        <div class="col-md-6">
            {{ form_row(form.nameFirst) }}
        </div>

        <div class="col-md-6">
            {{ form_row(form.nameLast) }}
        </div>
    </div>

    {{ form_rest(form) }}
{% endblock %}

{# Application to user import #}
{% block user_application_import_widget %}
    {{ form_errors(form) }}

    {% set data = form.vars.data.application %}

    {% if form.skipBillingData is defined %}
        <h3 class="mb-3">
            {{ 'application.to_user_import.billing_data'|trans }}
        </h3>

        <div class="row">
            <div class="col-12 d-flex">
                <div class="card mb-3 flex-fill">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-12 col-sm-6">
                                <span>
                                    {{ 'entity_attribute.application.name_full'|trans }}:
                                </span>
                            </div>

                            <div class="col-12 col-sm-6">
                                <span>
                                    {{ data.nameFull }}
                                </span>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12 col-sm-6">
                                <span>
                                    {{ 'entity_attribute.application.street'|trans }}:
                                </span>
                            </div>

                            <div class="col-12 col-sm-6">
                                <span>
                                    {{ data.street }}
                                </span>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12 col-sm-6">
                                <span>
                                    {{ 'entity_attribute.application.town'|trans }}:
                                </span>
                            </div>

                            <div class="col-12 col-sm-6">
                                <span>
                                    {{ data.town }}
                                </span>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12 col-sm-6">
                                <span>
                                    {{ 'entity_attribute.application.zip'|trans }}:
                                </span>
                            </div>

                            <div class="col-12 col-sm-6">
                                <span>
                                    {{ data.zip }}
                                </span>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12 col-sm-6">
                                <span>
                                    {{ 'entity_attribute.application.country'|trans }}:
                                </span>
                            </div>

                            <div class="col-12 col-sm-6">
                                <span>
                                    {{ country_name_for_code(data.country) }}
                                </span>
                            </div>
                        </div>

                        {% if data.businessName is not null and data.businessCin is not null and data.businessVatId is not null %}
                            <div class="row mt-3">
                                <div class="col-12 col-sm-6">
                                    <span>
                                        {{ 'entity_attribute.application.business_name'|trans }}:
                                    </span>
                                </div>

                                <div class="col-12 col-sm-6">
                                    <span>
                                        {{ data.businessName }}
                                    </span>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-12 col-sm-6">
                                    <span>
                                        {{ 'entity_attribute.application.business_cin'|trans }}:
                                    </span>
                                </div>

                                <div class="col-12 col-sm-6">
                                    <span>
                                        {{ data.businessCin }}
                                    </span>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-12 col-sm-6">
                                    <span>
                                        {{ 'entity_attribute.application.business_vat_id'|trans }}:
                                    </span>
                                </div>

                                <div class="col-12 col-sm-6">
                                    <span>
                                        {{ data.businessVatId }}
                                    </span>
                                </div>
                            </div>
                        {% endif %}

                        <div class="mt-4">
                            {{ form_row(form.skipBillingData) }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}

    {% if form.applicationImportToUserContactsData is defined %}
        {% set application_contact_forms = form.applicationImportToUserContactsData.children %}

        {% if application_contact_forms is not empty %}
            <h3 class="mb-3">
                {{ form.applicationImportToUserContactsData.vars.label|trans }}
            </h3>

            {% for application_import_contact_form in application_contact_forms %}
                {{ form_row(application_import_contact_form) }}
            {% endfor %}
        {% endif %}

        {% do form.applicationImportToUserContactsData.setRendered %}
    {% endif %}

    {% if form.applicationImportToUserCampersData is defined %}
        {% set application_camper_forms = form.applicationImportToUserCampersData.children %}

        {% if application_camper_forms is not empty %}
            <h3 class="mb-3">
                {{ form.applicationImportToUserCampersData.vars.label|trans }}
            </h3>

            {% for application_import_camper_form in application_camper_forms %}
                {{ form_row(application_import_camper_form) }}
            {% endfor %}
        {% endif %}

        {% do form.applicationImportToUserCampersData.setRendered %}
    {% endif %}

    {{ form_rest(form) }}
{% endblock %}

{# Application to user import (contact) #}
{% block user_application_import_contact_widget %}
    {{ form_errors(form) }}

    {% set contact = form.vars.data.applicationContact %}

    <div class="row">
        <div class="col-12 d-flex">
            <div class="card mb-4 flex-fill">
                <div class="card-body">
                    <h5 class="card-title">
                        {{ contact.nameFull }}
                    </h5>

                    {% if contact.email is not null %}
                        <div class="row">
                            <div class="col-12 col-sm-6">
                                <span>
                                    {{ 'entity_attribute.application_contact.email'|trans }}:
                                </span>
                            </div>

                            <div class="col-12 col-sm-6">
                                <span>
                                    {{ contact.email }}
                                </span>
                            </div>
                        </div>
                    {% endif %}

                    {% if contact.phoneNumber is not null %}
                        <div class="row">
                            <div class="col-12 col-sm-6">
                                <span>
                                    {{ 'entity_attribute.application_contact.phone_number'|trans }}:
                                </span>
                            </div>

                            <div class="col-12 col-sm-6">
                                <span>
                                    {{ contact.phoneNumber|phone_number_format(phone_number_format) }}
                                </span>
                            </div>
                        </div>
                    {% endif %}

                    <div class="row">
                        <div class="col-12 col-sm-6">
                            <span>
                                {{ 'entity_attribute.application_contact.role'|trans }}:
                            </span>
                        </div>

                        <div class="col-12 col-sm-6">
                            <span>
                                {% if contact.role.value == 'other' %}
                                    {{ contact.roleOther }}
                                {% else %}
                                    {{ ('contact_role.' ~ contact.role.value)|trans }}
                                {% endif %}
                            </span>
                        </div>
                    </div>

                    <div class="mt-4">
                        {{ form_row(form.importToContact) }}
                    </div>
                </div>
            </div>
        </div>
    </div>

    {{ form_rest(form) }}
{% endblock %}

{# Application to user import (camper) #}
{% block user_application_import_camper_widget %}
    {{ form_errors(form) }}

    {% set camper = form.vars.data.applicationCamper %}

    <div class="row">
        <div class="col-12 d-flex">
            <div class="card mb-4 flex-fill">
                <div class="card-body">
                    <h5 class="card-title">
                        {{ camper.nameFull }}
                    </h5>

                    <div class="row">
                        <div class="col-12 col-sm-6">
                            <span>
                                {{ 'entity_attribute.camper.gender'|trans }}:
                            </span>
                        </div>

                        <div class="col-12 col-sm-6">
                            <span>
                                {{ ('gender_childish.' ~ camper.gender.value)|trans }}
                            </span>
                        </div>
                    </div>

                    {% if national_identifier_enabled and camper.nationalIdentifier is not null %}
                        <div class="row">
                            <div class="col-12 col-sm-6">
                                <span>
                                    {{ 'entity_attribute.camper.national_identifier'|trans }}:
                                </span>
                            </div>

                            <div class="col-12 col-sm-6">
                                <span>
                                    {{ camper.nationalIdentifier }}
                                </span>
                            </div>
                        </div>
                    {% endif %}

                    <div class="row">
                        <div class="col-12 col-sm-6">
                            <span>
                                {{ 'entity_attribute.camper.born_at'|trans }}:
                            </span>
                        </div>

                        <div class="col-12 col-sm-6">
                            <span>
                                {{ camper.bornAt|date(date_format) }}
                            </span>
                        </div>
                    </div>

                    {% if camper.dietaryRestrictions is not null %}
                        <div class="row">
                            <div class="col-12 col-sm-6">
                                <span>
                                    {{ 'entity_attribute.camper.dietary_restrictions'|trans }}:
                                </span>
                            </div>

                            <div class="col-12 col-sm-6">
                                <span>
                                    {{ camper.dietaryRestrictions|nl2br }}
                                </span>
                            </div>
                        </div>
                    {% endif %}

                    {% if camper.healthRestrictions is not null %}
                        <div class="row">
                            <div class="col-12 col-sm-6">
                                <span>
                                    {{ 'entity_attribute.camper.health_restrictions'|trans }}:
                                </span>
                            </div>

                            <div class="col-12 col-sm-6">
                                <span>
                                    {{ camper.healthRestrictions|nl2br }}
                                </span>
                            </div>
                        </div>
                    {% endif %}

                    {% if camper.medication is not null %}
                        <div class="row">
                            <div class="col-12 col-sm-6">
                                <span>
                                    {{ 'entity_attribute.camper.medication'|trans }}:
                                </span>
                            </div>

                            <div class="col-12 col-sm-6">
                                <span>
                                    {{ camper.medication|nl2br }}
                                </span>
                            </div>
                        </div>
                    {% endif %}

                    <div class="mt-4">
                        {{ form_row(form.importToCamper) }}
                    </div>
                </div>
            </div>
        </div>
    </div>

    {{ form_rest(form) }}
{% endblock %}

{# Application step one edit #}
{% block user_application_step_one_widget %}
    {{ form_errors(form) }}

    <h3 class="mb-3">
        {{ 'application.buyer_details'|trans }}
    </h3>

    {{ form_row(form.email) }}

    <div class="form-row">
        <div class="col-md-6">
            {{ form_row(form.nameFirst) }}
        </div>

        <div class="col-md-6">
            {{ form_row(form.nameLast) }}
        </div>
    </div>

    {{ form_row(form.street) }}
    {{ form_row(form.town) }}
    {{ form_row(form.zip) }}
    {{ form_row(form.country) }}
    {{ form_row(form.isCompany) }}
    {{ form_row(form.businessName) }}
    {{ form_row(form.businessCin) }}
    {{ form_row(form.businessVatId) }}

    {{ form_row(form.applicationFormFieldValuesData) }}
    {{ form_row(form.applicationAttachmentsData) }}

    <h3 class="mb-3">
        {{ form.contactsData.vars.label|trans }}
    </h3>

    {{ form_row(form.contactsData, {label: false}) }}
    {{ form_row(form.addContactData) }}

    <h3 class="mb-3">
        {{ form.applicationCampersData.vars.label|trans }}
    </h3>

    {{ form_row(form.applicationCampersData, {label: false}) }}
    {{ form_row(form.addCamperData) }}

    {{ block('user_application_bottom') }}

    {{ form_rest(form) }}
{% endblock %}

{# Application step two edit #}
{% block user_application_step_two_widget %}
    {{ form_errors(form) }}

    {{ form_row(form.paymentMethod) }}

    {% if form.discountSiblingsInterval is defined %}
        {{ form_row(form.discountSiblingsInterval) }}
    {% endif %}

    {% if form.applicationCamperPurchasableItemsData is defined %}
        {% set label = form.applicationCamperPurchasableItemsData.vars.label %}

        {% if label %}
            <h3 class="mb-3">
                {{ label|trans }}
            </h3>
        {% endif %}

        {{ form_widget(form.applicationCamperPurchasableItemsData) }}
    {% endif %}

    {% if form.applicationPurchasableItemsData is defined %}
        {% set label = form.applicationPurchasableItemsData.vars.label %}

        {% if label %}
            <h3 class="mb-3">
                {{ label|trans }}
            </h3>
        {% endif %}

        {{ form_widget(form.applicationPurchasableItemsData) }}
    {% endif %}

    <h3 class="mb-3">
        {{ 'application.few_more_optional_fields'|trans }}
    </h3>

    {{ form_row(form.customerChannel) }}

    {{ form_row(form.customerChannelOther) }}

    {{ form_row(form.note) }}

    {{ block('user_application_bottom') }}

    {{ form_rest(form) }}
{% endblock %}

{# Application step three edit #}
{% block user_application_step_three_widget %}
    {{ form_errors(form) }}

    {% if form.captcha is defined %}
        {{ form_row(form.captcha) }}
    {% endif %}

    {{ form_row(form.privacy) }}
    {{ form_row(form.terms) }}

    {{ block('user_application_bottom') }}

    {{ form_rest(form) }}
{% endblock %}

{% block user_application_bottom %}
    <div class="row mt-4">
        {% if application_back_url is defined %}
            <div class="col-6">
                <a class="btn btn-secondary" href="{{ application_back_url }}" role="button">
                    {{ 'back'|trans }}
                </a>
            </div>
        {% endif %}

        <div class="{% if application_back_url is defined %} col-6 {% else %} col-12 {% endif %} text-right">
            {{ form_row(form.submit) }}
        </div>
    </div>
{% endblock %}

{# Application camper purchasable item #}
{% block user_application_camper_purchasable_items_widget %}
    {{ form_errors(form) }}

    {% set applicationPurchasableItemsVars = form.applicationPurchasableItemsData.vars %}
    {% set applicationPurchasableItemsLabel = applicationPurchasableItemsVars.label %}
    {% set applicationPurchasableItemsLabelVars = applicationPurchasableItemsVars.label_translation_parameters %}

    <h3 class="mb-3">
        {{ applicationPurchasableItemsLabel|trans(applicationPurchasableItemsLabelVars) }}
    </h3>

    {{ form_widget(form.applicationPurchasableItemsData) }}

    {{ form_rest(form) }}
{% endblock %}

{# Application purchasable item widget #}
{% block user_application_purchasable_item_widget %}
    {{ form_errors(form) }}

    {% set index = form.vars.name %}
    {% set children = form.children %}
    {% set data = form.vars.data %}
    {% set application_purchasable_item = data.applicationPurchasableItem %}
    {% set purchasable_item = application_purchasable_item.purchasableItem %}
    {% set application = application_purchasable_item.application %}
    {% set label = children.applicationPurchasableItemInstancesData.vars.label %}
    {% set image_extension = purchasable_item is null ? null : purchasable_item.imageExtension %}

    <div class="row {% if image_extension is null %} mb-1 {% else %} mb-3 {% endif %}">
        <div class="col-12">
            <div>
                {% if application_purchasable_item.description is null %}
                    <h5>{{ label }}</h5>
                {% else %}
                    {% set item_id = application_purchasable_item.id %}

                    <h5>
                        {{ label }}

                        <a href="#purchasable-item-description-{{ item_id }}"
                           data-toggle="modal"
                           data-target="#purchasable-item-description-{{ item_id }}"
                        >
                            <i class="fas fa-info-circle"></i>
                        </a>
                    </h5>

                    <div class="modal fade"
                         id="purchasable-item-description-{{ item_id }}"
                         tabindex="-1"
                         aria-labelledby="purchasable-item-description-{{ item_id }}"
                         aria-hidden="true"
                    >
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">
                                        {{ 'entity_attribute.purchasable_item.description'|trans }}
                                    </h5>

                                    <button type="button"
                                            class="close"
                                            data-dismiss="modal"
                                            aria-label="{{ 'modal.button_close'|trans }}"
                                    >
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>

                                <div class="modal-body">
                                    <p>{{ application_purchasable_item.description|nl2br }}</p>
                                </div>

                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">
                                        {{ 'modal.button_close'|trans }}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}
            </div>

            <div>
                <span>
                    {{ 'entity_attribute.application_purchasable_item.price'|trans }}:
                    {{ application_purchasable_item.price|format_currency(application.currency) }}
                </span>
            </div>

            {% if application.isPurchasableItemsIndividualMode %}
                {% set max_amount = application_purchasable_item.maxAmount %}
            {% else %}
                {% set max_amount = application_purchasable_item.calculatedMaxAmount %}
            {% endif %}

            {% if max_amount > 1 %}
                <div>
                    <span>
                        {{ 'entity_attribute.application_purchasable_item.max_amount'|trans }}:
                        {{ max_amount }}
                    </span>
                </div>
            {% endif %}
        </div>

        {% if image_extension is not null %}
            <div class="col-12">
                <div class="row mt-2">
                    <div class="col-6 col-md-4">
                        <a href="{{ asset(purchasable_item_image_path(purchasable_item)) }}"
                           target="_blank"
                        >
                            <img class="image-cover-16-9"
                                 src="{{ asset(purchasable_item_image_path(purchasable_item)) }}"
                                 alt="{{ purchasable_item.name }}"
                            >
                        </a>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>

    {{ form_row(children.applicationPurchasableItemInstancesData, {label: false}) }}

    {% if children.addApplicationPurchasableItemInstanceData is defined %}
        {{ form_row(children.addApplicationPurchasableItemInstanceData) }}
    {% endif %}

    {{ form_rest(form) }}
{% endblock %}

{# Application attachments widget #}
{% block user_application_attachments_label %}
    <h5 class="mb-3">
        {{ form.vars.label|trans(form.vars.label_translation_parameters) }}
    </h5>
{% endblock %}